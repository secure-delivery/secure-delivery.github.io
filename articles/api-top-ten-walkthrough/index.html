<!doctype html>
<html><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/output.css" rel="stylesheet">
  
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-BCGW8B7J2T"></script>
      <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
  
      gtag('config', 'G-BCGW8B7J2T');
      </script>
  
    <script src="//unpkg.com/alpinejs" defer></script>
  
    <title>The World's Best Product Security Training - Secure Delivery</title>
  
    
      <script>window.pipedriveLeadboosterConfig = {base: 'leadbooster-chat.pipedrive.com',companyId: 7866507,playbookUuid: '74a02c57-03ea-482b-a89b-c49910bdb5eb',version: 2};(function () {var w = window;if (w.LeadBooster) {console.warn('LeadBooster already exists');} else {w.LeadBooster = {q: [],on: function (n, h) {this.q.push({ t: 'o', n: n, h: h });},trigger: function (n) {this.q.push({ t: 't', n: n });},};}})();</script><script src="https://leadbooster-chat.pipedrive.com/assets/loader.js" async></script>
  </head><body>
	<div class="bg-white">
<header class="absolute inset-x-0 top-0 z-50">
    <nav class="mx-auto flex max-w-7xl items-center justify-between p-6 lg:px-8" aria-label="Global">
    <div class="flex lg:flex-1">
        <a href="/" class="-m-1.5 p-1.5">
        <span class="sr-only">Secure Delivery</span>
        <img class="h-8 w-auto" src="/images/logomark-coral.png" alt="">
        </a>
    </div>
    <div x-data class="flex lg:hidden">
        <button @click="$dispatch('open-me')" type="button" class="-m-2.5 inline-flex items-center justify-center rounded-md p-2.5 text-gray-700">
        <span class="sr-only">Open main menu</span>
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" />
        </svg>
        </button>
    </div>
    <div class="hidden lg:flex lg:gap-x-12">
        <a href="/assessments" class="text-sm font-semibold leading-6 text-gray-900">Assessments</a>
        <a href="/articles" class="text-sm font-semibold leading-6 text-gray-900">Insights</a>
        <a href="/news" class="text-sm font-semibold leading-6 text-gray-900">News</a>
        <a href="#contact-us" class="text-sm font-semibold leading-6 text-gray-900">Contact Us</a>
    </div>
    <div class="hidden lg:flex lg:flex-1 lg:justify-end">
        <a href="https://academy.securedelivery.io/" class="text-sm font-semibold leading-6 text-gray-900">Log in to the Academy <span aria-hidden="true">&rarr;</span></a>
    </div>
    </nav>
    
    <div x-data="{open: false}" @open-me.window="open=true" @close-me.window="open=false">
    <template x-if="open" hidden>
        <div class="lg:hidden" role="dialog" aria-modal="true">
        
        <div class="fixed inset-0 z-50"></div>
        <div class="fixed inset-y-0 right-0 z-50 w-full overflow-y-auto bg-white px-6 py-6 sm:max-w-sm sm:ring-1 sm:ring-gray-900/10">
            <div class="flex items-center justify-between">
            <a href="#" class="-m-1.5 p-1.5">
                <span class="sr-only">Your Company</span>
                <img class="h-8 w-auto" src="/images/logomark-coral.png" alt="Secure Delivery logo">
            </a>
            <button @click="$dispatch('close-me')" type="button" class="-m-2.5 rounded-md p-2.5 text-gray-700">
                <span class="sr-only">Close menu</span>
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            </div>
            <div class="mt-6 flow-root">
            <div class="-my-6 divide-y divide-gray-500/10">
                <div class="space-y-2 py-6">
                <a href="/" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:bg-gray-50">Home</a>
                <a href="/assessments" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:bg-gray-50">Assessments</a>
                <a href="/articles" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:bg-gray-50">Insights</a>
                <a href="/news" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:bg-gray-50">News</a>
                <a href="#contact-us" class="-mx-3 block rounded-lg px-3 py-2 text-base font-semibold leading-7 text-gray-900 hover:bg-gray-50">Contact Us</a>
                </div>
                <div class="py-6">
                <a href="https://academy.securedelivery.io/" class="-mx-3 block rounded-lg px-3 py-2.5 text-base font-semibold leading-7 text-gray-900 hover:bg-gray-50">Log in to the Academy <span aria-hidden="true">&rarr;</span></a>
                </div>
            </div>
            </div>
        </div>
        </div>
    </template>
    </div>
</header>

<div class="relative isolate pt-14">
    <div class="absolute inset-x-0 -top-40 -z-10 transform-gpu overflow-hidden blur-3xl sm:-top-80" aria-hidden="true">
      <div class="relative left-[calc(50%-11rem)] aspect-[1155/678] w-[36.125rem] -translate-x-1/2 rotate-[30deg] bg-gradient-to-tr from-[#ff80b5] to-[#9089fc] opacity-30 sm:left-[calc(50%-30rem)] sm:w-[72.1875rem]" style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)"></div>
    </div>
    <div class="py-24 sm:py-32 lg:pb-40">
      <div class="mx-auto max-w-7xl px-6 lg:px-8">
        <div class="mx-auto max-w-3xl text-center">
          <h1 class="text-4xl font-bold tracking-tight text-gray-900 sm:text-6xl">OWASP API Top 10 CTF Walk-through</h1>

		  <p class="font-semibold text-gray-700 mt-4">
			Grant Ongers
		  </p>

          <p class="mt-6 text-lg leading-8 text-gray-600">So you wanna hack an API? Let&#39;s analyse an API using the OWASP API Security Top 10 to guide our effort and hack it, together. Maybe we&#39;ll capture some flags while we&#39;re at it?	</p>

		  <div class="mt-8 flex justify-center items-center gap-x-4 text-xs">
				<time datetime="2020-03-16" class="text-gray-500">March 10, 2022</time>
				
				<a href="#" class="relative z-10 rounded-full bg-gray-50 px-3 py-1.5 font-medium text-gray-600 hover:bg-gray-100">API Security</a>
				
				<a href="#" class="relative z-10 rounded-full bg-gray-50 px-3 py-1.5 font-medium text-gray-600 hover:bg-gray-100">Capture The Flag</a>
				
			</div>
        </div>
        <div class="mt-16 flow-root sm:mt-24">
          <div class="-m-2 lg:-m-4 lg:rounded-2xl lg:p-4">
			
				
						<img src="/articles/api-top-ten-walkthrough/api_hufee1221a0f56a53ad4b1b511534642d6_2768262_2000x1022_resize_q75_h2_box_3.webp" width="2000" height="1022" class="rounded-md shadow-2xl ring-1 ring-gray-900/10">
					
				
          </div>
        </div>

		
		<div class="flex justify-center px-6 py-32 lg:px-8">
				<div class="prose sm:prose-lg">
					<p>I&rsquo;ve been promising this walk-through for a while now (ever since first updating this material to use the awesome vAPI CTF 1.1) and now I&rsquo;ve finally gotten around to it.</p>
<h3 id="getting-started">Getting started</h3>
<h4 id="to-get-started-with-youll-need-to-have-access-to-the-following-tools">To get started with you&rsquo;ll need to have access to the following tools:</h4>
<ul>
<li><a href="https://www.docker.com/get-started">Docker</a> - please ensure that you can use <code>docker-compose</code>;</li>
<li><a href="https://git-scm.com/downloads">git</a> - please make sure you can <code>git clone</code> <strong><em>public</em></strong> repositories;</li>
<li><a href="https://www.postman.com/downloads/">Postman</a>; and of course</li>
<li><a href="https://www.zaproxy.org/download/">ZAP</a>.</li>
</ul>
<p>Then there are the bonus tools, and I say bonus because I was unable to make either work on both my new Mac (new Mac silicone FTW), or my Ubuntu machine (I don&rsquo;t use Wayland on my XPS). You only need one of these tools, so pick the one suitable for your OS.</p>
<ul>
<li><a href="https://waydro.id/">Waydroid</a>; or</li>
<li><a href="https://www.bluestacks.com/download.html">Bluestacks</a></li>
</ul>
<h4 id="youll-also-need-to-grab-that-deliberately-vulnerable-api">You&rsquo;ll also need to grab that deliberately vulnerable API:</h4>
<p>We are going to be leveraging Tushar (<a href="https://github.com/roottusk">roottusk</a>) Kulkarni&rsquo;s well put together <a href="https://github.com/roottusk/vapi">vAPI</a> which is a Capture the Flag (CTF) style exercise covering off the <a href="https://owasp.org/">OWASP</a> <a href="https://owasp.org/www-project-api-security/">API Top 10</a>. The project is self-contained, leveraging Docker to provide the full requirements and can be grabbed from:</p>
<ul>
<li>his GitHub repository <code>git clone https://github.com/roottusk/vapi.git</code>; or</li>
<li>the Secure Delivery one <code>git clone https://github.com/secure-delivery/vapi.git</code></li>
</ul>
<p>Once your clone has completed you simply need to:</p>
<pre tabindex="0"><code>cd vapi
docker-compose up -d
</code></pre><p>You can test that the API has successfully launched by hitting <code>http://localhost/vapi/</code> to see that a Laravel server is up and running and listening there.</p>
<h4 id="then-we-want-to-launch-our-testing-applications-postman-and-zap">Then we want to launch our testing applications, Postman and ZAP.</h4>
<p>In Postman, we want to import the files in the <code>vapi/postman/</code> folder which will provide you with both an <strong>Environment</strong> and the <strong>Collection</strong> of API end-points to get started with.</p>
<p>When launching ZAP we want to make sure that it&rsquo;s configured to accept external requests. The easiest way is to launch ZAP with the following switches <code>zap.sh -config api.addrs.addr.name=.* -config api.addrs.addr.regex=true</code></p>
<h4 id="we-then-need-to-ensure-that-traffic-is-properly-proxied-to-our-api-through-zap-when-we-use-postman">We then need to ensure that traffic is properly proxied to our API through ZAP when we use Postman.</h4>
<p>In Postman you need to check and change a couple of things:</p>
<ul>
<li>
<p>Start by ensuring that you configure a proxy server for Postman to use:
<img src="api-1.png" alt="Postman configuration - proxy settings"></p>
</li>
<li>
<p>You should also make sure that on your Environments tab the vAPI_ENV for host is set correctly:
<img src="api-2.png" alt="Postman configuration - host settings"></p>
</li>
<li>
<p>You need to also ensure that you have enabled the Environment file for Postman
<img src="api-3.png" alt="Postman configuration - environment settings"></p>
</li>
</ul>
<p>In ZAP now you check to ensure a couple of things:</p>
<ul>
<li>
<p>Firstly that it&rsquo;s running as a proxy (ensure that the port number here matches your settings in Postman earlier)
<img src="api-4.png" alt="ZAP configuration - proxy settings"></p>
</li>
<li>
<p>That your start-up config came through correctly.
<img src="api-5.png" alt="ZAP configuration - startup settings"></p>
</li>
<li>
<p>While we are here let&rsquo;s make ZAP super aggressive when fuzzing. You may want to tweak this if your machine appears to struggle but the higher your number of concurrent scans and the lower your delay is the faster you&rsquo;ll fuzz.
<img src="api-7.png" alt="ZAP configuration - fuzzer settings"></p>
</li>
<li>
<p>And then turn off the ZAP HUD. Trust me on this one, if you find ZAP not properly proxying your requests (turning POST requests into GET for example) this is going to be why - there is an open <a href="https://github.com/zaproxy/zaproxy/issues/5592">issue</a> describing the frustrations you&rsquo;ll feel here.
<img src="api-6.png" alt="ZAP configuration - HUD settings"></p>
</li>
</ul>
<h3 id="owasp-api-top-10">OWASP API Top 10</h3>
<p>Whew, still here? Excellent. Now let&rsquo;s get to hacking. Starting with&hellip;</p>
<h4 id="1-broken-object-level-authorization">#1 Broken Object Level Authorization</h4>
<p>Authorization is about <strong><em>access control</em></strong>, or <strong>what actions</strong> are permitted against <strong>which objects</strong>. The short version of this vulnerability is that a particular object (chunk of data) is not protected the way it should be. There are many reasons this can happen and why it&rsquo;s more likely potentially to happen in APIs rather than standard web applications&hellip; all reasons that we go into when running through these as an exercise, but we&rsquo;re just here for the hacks right now.</p>
<p>The exercise is a simple one:</p>
<ul>
<li>
<p>Use the <code>POST</code> request to create a new user (populating it with data first)
<img src="api-8.png" alt="Postman - API1 - POST User creation"></p>
</li>
<li>
<p>Use the <code>GET</code> request to get that user&rsquo;s details. Notice that the request uses a variable <code>{{api1_id}}</code> for the endpoint whose details we are collecting. That variable was populated with a response value from the <code>POST</code> above&hellip;
<img src="api-9.png" alt="Postman - API1 - GET User details"></p>
</li>
<li>
<p>What happens if we manually manipulate that value? In ZAP we can simply grab the <code>GET</code> request from earlier and use the Manual Request Editor to modify the value (to 1 in this example). And as you can see we get our first flag!
<img src="api-10.png" alt="ZAP - API1 - Manual Request Editor - Request">
<img src="api-11.png" alt="ZAP - API1 - Manual Request Editor - Response"></p>
</li>
<li>
<p>I use ZAP for this and not Postman because even though it&rsquo;s just as easy to modify that endpoint in Postman I want to also show you that authentication IS required and that&rsquo;s easy to quickly do in ZAP.
<img src="api-12.png" alt="ZAP - API1 - Manual Request Editor - Invalid Request">
<img src="api-13.png" alt="ZAP - API1 - Manual Request Editor - Invalid Response">
<img src="api-14.png" alt="ZAP - API1 - Manual Request Editor - NoAuth Request">
<img src="api-15.png" alt="ZAP - API1 - Manual Request Editor - NoAuth Response"></p>
</li>
<li>
<p>The <code>PUT</code> request (for updating the account details) can also be used to show that there is some auth happening, and not all actions are affected by the issue.
<img src="api-16.png" alt="ZAP - API1 - Manual Request Editor - PUT Request">
<img src="api-17.png" alt="ZAP - API1 - Manual Request Editor - PUT Response"></p>
</li>
</ul>
<h4 id="2-broken-user-authentication">#2 Broken User Authentication</h4>
<p>Where #1 was all about access control, authentication (or AuthC as it&rsquo;s called), is all about identity. While this is a problem in most disciplines there are a lot of reasons that it ranks so highly in the API world, starting with the fact that most identity measures involve a secret that has a tendency to end up in your repository&hellip;</p>
<p>But let&rsquo;s get into the exercise:</p>
<ul>
<li>
<p>Use the <code>POST</code> request with some random details filled in to try to log into the system.
<img src="api-18.png" alt="Postman - API2 - POST User login"></p>
</li>
<li>
<p>The eagle-eyed might have noticed a folder called <code>vapi/Resources/API2_CredentialStuffing</code> when loading the <code>vapi/postman/</code> files. If you take a closer look at that folder you&rsquo;ll discover that those secrets are indeed out there.</p>
</li>
<li>
<p>Switch to ZAP and take a look at the request you just sent. We are going to use ZAP&rsquo;s Fuzzer now along with that credentials list to try see if any users in that breach are users of this system, and (if they are), to see whether they&rsquo;ve reused their passwords&hellip;</p>
</li>
<li>
<p>Select the POST request, high-light the login details, right-click and select <strong>Fuzz</strong>
<img src="api-19.png" alt="ZAP - API2 - Fuzzing 1"></p>
</li>
<li>
<p>Click on <strong>Payloads</strong>, then <strong>Add</strong> and paste in the quick and dirty modified version of the <code>creds.csv</code> file that I&rsquo;ve included <a href="../resources/creds.csv">here</a> (using some rough concatenation to make ZAP&rsquo;s job easier)
<img src="api-20.png" alt="ZAP - API2 - Fuzzing 2"></p>
</li>
<li>
<p>Hit <strong>Add</strong> again then <strong>OK</strong> and finally <strong>Start Fuzzer</strong>. The Fuzzer will run for a while (depending on how many resources you&rsquo;ve got available to the API and to ZAP) and then boom:
<img src="api-21.png" alt="ZAP - API2 - Fuzzing 3"></p>
</li>
<li>
<p>All that&rsquo;s left to do is to use one of those valid Authorization-Tokens on the <code>GET</code> request to find your second flag
<img src="api-22.png" alt="ZAP - API2 - Fuzzed Token">
<img src="api-23.png" alt="ZAP - API2 - Manual Request Editor - Request">
<img src="api-24.png" alt="ZAP - API2 - Manual Request Editor - Response"></p>
</li>
</ul>
<h4 id="3-excessive-data-exposure">#3 Excessive Data Exposure</h4>
<p>Again, this is an issue in many technologies but because of what APIs are intended for there is a particular concern around this here. It starts with the fact that APIs are usually fronted by an application for users, and that application generally does something to present the data back to the user. It also has to do with the fact that APIs try to be self-describing and so mau provide mote meta-data than they perhaps should.</p>
<p>Exercise 3 is the one where you&rsquo;ll need to break out the Android virtualisation platform (should you have one working). Don&rsquo;t worry too much if you don&rsquo;t, I have screenshots, and you&rsquo;ll be able to follow along just fine.</p>
<ul>
<li>
<p>If you&rsquo;re able to run <code>vapi/Resources/API3_APK/TheCommentApp.apk</code> then do that, pointing the app at your instance of vAPI (through ZAP as your proxy), creating an account and then logging in and posting a comment.
<img src="api-25.png" alt="APK - API3 - Configure">
<img src="api-26.png" alt="APK - API3 - Login">
<img src="api-27.png" alt="APK - API3 - Post comment"></p>
</li>
<li>
<p>Alternatively you can use Postman to do the same things
<img src="api-28.png" alt="Postman - API3 - Create user">
<img src="api-29.png" alt="Postman - API3 - Login">
<img src="api-30.png" alt="Postman - API3 - Get Comment"></p>
</li>
</ul>
<p>BANG! Flag number three in the bag.</p>
<p>We really need to have a word with those developers. Not only are they providing data back to the API that the GUI never users (or needs) they are also collecting information (probably for marketing) that we don&rsquo;t need and should never have!</p>
<h4 id="4-lack-of-resources--rate-limiting">#4 Lack of Resources &amp; Rate Limiting</h4>
<p>This is an interesting one, mostly because APIs are designed for computers and because computers work faster, and so request and process quicker than humans do.</p>
<p>We&rsquo;ve already done an exercise that shows this (remember the credential stuffing?) but this is another good opportunity to try out some more ZAP fuzzing:</p>
<ul>
<li>
<p>Use Postman to initiate a mobile login, putting the API into a state that expects a PIN to be entered next.
<img src="api-31.png" alt="Postman - API4 - Mobile Login"></p>
</li>
<li>
<p>Attempt a login with any random PIN.
<img src="api-32.png" alt="Postman - API4 - PIN attempt"></p>
</li>
<li>
<p>Switch to ZAP and select the OTP POST request, high-light the PIN, right-click and select <strong>Fuzz</strong>.
<img src="api-33.png" alt="ZAP - API4 - Fuzzing 1"></p>
</li>
<li>
<p>Click on <strong>Payloads</strong>, then <strong>Add</strong> and change the dropdown to <strong>Numberz</strong>. Set the starting number to <strong><em>1000</em></strong> and the ending one to <strong><em>9999</em></strong>.
<img src="api-34.png" alt="ZAP - API4 - Fuzzing 2"></p>
</li>
<li>
<p>Hit <strong>Add</strong> again then <strong>OK</strong> and finally <strong>Start Fuzzer</strong>. The Fuzzer will run for a little longer this time until eventually it spits out the right PIN. You can hit the stop button to the right of the fuzzer&rsquo;s name to stop it once it&rsquo;s done so.
<img src="api-35.png" alt="ZAP - API4 - Fuzzing 4"></p>
</li>
<li>
<p>All that&rsquo;s left to do is to log in with the correct PIN, then hit the <code>GET</code> request for the details and your fourth flag
<img src="api-36.png" alt="Postman - API4 - PIN attempt 2">
<img src="api-37.png" alt="Postman - API4 - GET Details"></p>
</li>
</ul>
<h4 id="5-broken-function-level-authorization">#5 Broken Function Level Authorization</h4>
<p>We talked about Broken <strong>Object</strong> Level Authorization in #1, and this is much the same type of problem but then not on the data level but rather on the action level. The easiest way to think about this is some level of privileged access accidentally being available to ordinary users.</p>
<p>The exercise gives us a chance to try some ZAP addons:</p>
<ul>
<li>
<p>Addons for ZAP can be installed like this straight from within ZAP itself. For this exercise you&rsquo;ll want to install <strong>FuzzDB Files</strong>.
<img src="api-38.png" alt="ZAP - API5 - Addon Install"></p>
</li>
<li>
<p>In Postman you&rsquo;ll want to fire off the create user <code>POST</code> request.
<img src="api-39.png" alt="Postman - API5 - Create user"></p>
</li>
<li>
<p>We&rsquo;ll follow up with the <code>GET</code> user request
<img src="api-40.png" alt="Postman - API5 - Get user"></p>
</li>
<li>
<p>Back in ZAP we&rsquo;re going to attack that <code>GET</code> request and see if there are any more privileged endpoints we can fuzz. Select the <code>GET</code> request, high-light the endpoint, right-click and select <strong>Fuzz</strong>
<img src="api-41.png" alt="ZAP - API5 - Fuzzing 1"></p>
</li>
<li>
<p>Click on <strong>Payloads</strong>, then <strong>Add</strong>. This time we are going to change the selection to File Fuzzers, and we&rsquo;re going to select the <strong>fuzzdb</strong> -&gt; <strong>discovery</strong> -&gt; <strong>common-methods</strong>
<img src="api-42.png" alt="ZAP - API5 - Fuzzing 2"></p>
</li>
<li>
<p>Hit <strong>Add</strong> again then <strong>OK</strong> and finally <strong>Start Fuzzer</strong>. The Fuzzer will run a bit before hitting <code>users</code> and our fifth flag.
<img src="api-43.png" alt="ZAP - API5 - Fuzzing 3"></p>
</li>
</ul>
<h4 id="6-mass-assignment">#6 Mass Assignment</h4>
<p>Mass assignment requires a little explanation for most folks who&rsquo;ve never run across it before - so pretty much anyone who isn&rsquo;t an object orientated programmer.</p>
<p>Essentially this vulnerability relies on the fact that classes of objects may have special or restricted attributes on them that should only be modified through restricted methods but the implementation on a less restricted method might allow it to update those - even though the API might not advertise the fact.</p>
<p>Let&rsquo;s take a look in practice:</p>
<ul>
<li>
<p>In Postman use the <code>POST</code> API to create a user.
<img src="api-44.png" alt="Postman - API6 - Create user"></p>
</li>
<li>
<p>Now <code>GET</code> that user&rsquo;s details and see that the <code>GET</code> response contains more data in it than the <code>POST</code> did.
<img src="api-45.png" alt="Postman - API6 - Get user"></p>
</li>
<li>
<p>Can we use that? Let&rsquo;s use Postman to modify our <code>POST</code> for user creation like this.
<img src="api-46.png" alt="Postman - API6 - Create user 2"></p>
</li>
<li>
<p>And then <code>GET</code> that same user back again.
<img src="api-47.png" alt="Postman - API6 - Get user 2"></p>
</li>
</ul>
<h4 id="7-security-misconfiguration">#7 Security Misconfiguration</h4>
<p>This is a big one, and a bit of a catch-all if I&rsquo;m being honest. There are many aspects of configuration that can end up leading to less secure setups. Fortunately ZAP is brilliant at helping us to identify those.</p>
<p>The exercise we&rsquo;re going to run here is simply hitting the endpoints provided with Postman initially.</p>
<ul>
<li>
<p>Create a user with the <code>POST</code> method.
<img src="api-48.png" alt="Postman - API7 - Create user"></p>
</li>
<li>
<p>Log the user in with the provided <code>GET</code> request.
<img src="api-49.png" alt="Postman - API7 - Login user"></p>
</li>
<li>
<p>Leverage the <code>GET</code> key request.
<img src="api-50.png" alt="Postman - API7 - Get key"></p>
</li>
<li>
<p>Switch over to ZAP and that a look at the <strong>Alerts</strong> tab.
<img src="api-51.png" alt="ZAP - API7 - Alerts tab"></p>
</li>
</ul>
<p>So there&rsquo;s a CORS vulnerability we might be able to exploit, possibly with some JAVAScript and a page hosted elsewhere&hellip; and the first time I did this CTF I actually did just that. The problem is that MOST browsers are very careful about CORS now&hellip; API clients need not be so well-behaved.</p>
<ul>
<li>Simply modifying the <code>GET</code> key request to include an Origin header from somewhere else&hellip; our seventh flag!
<img src="api-52.png" alt="ZAP - API7 - Manual Request Editor - Request">
<img src="api-53.png" alt="ZAP - API7 - Manual Request Editor - Response"></li>
</ul>
<h4 id="8-injection">#8 Injection</h4>
<p>Just like web applications, APIs can experience injection attacks in their various forms.</p>
<p>This exercise is a basic SQL Injection attack and a great opportunity to flex our ZAP skills again.</p>
<ul>
<li>
<p>Using Postman and the <code>POST</code> endpoint attempt to log in.
<img src="api-54.png" alt="Postman - API8 - User login attempt"></p>
</li>
<li>
<p>Switch to ZAP and select the login POST request, high-light the password, right-click and select <strong>Fuzz</strong>.
<img src="api-55.png" alt="ZAP - API8 - Fuzzing 1"></p>
</li>
<li>
<p>Hit the Edit button and blank out the username value, hit Save afterwards.
<img src="api-56.png" alt="ZAP - API8 - Fuzzing 2"></p>
</li>
<li>
<p>Click on <strong>Payloads</strong>, then <strong>Add</strong> and change the dropdown to <strong>File Fuzzers</strong>. Select <strong>fuzzdb</strong> -&gt; <strong>attack</strong> -&gt; <strong>sql-injection</strong> -&gt; <strong>exploit</strong> -&gt; <strong>mysql-injection-login-bypass.txt</strong>.
<img src="api-57.png" alt="ZAP - API8 - Fuzzing 3"></p>
</li>
<li>
<p>Hit <strong>Add</strong> again then <strong>OK</strong> and finally <strong>Start Fuzzer</strong>. The Fuzzer will run for a little longer this time until eventually it spits out the right PIN. You can hit the stop button to the right of the fuzzer&rsquo;s name to stop it once it&rsquo;s done so.
<img src="api-58.png" alt="ZAP - API8 - Fuzzing 4"></p>
</li>
<li>
<p>All that&rsquo;s left to do is to re-run the <code>GET</code> Secret with the authkey acquired above for flag number 8!
<img src="api-59.png" alt="Postman - API8 - Get secret"></p>
</li>
</ul>
<p>If you are having trouble with your FuzzDB files, you may need to ensure that there is a space after the dashes in your SQLi <code>' or 1=1-- </code> (sometimes it does seem to get swallowed.)</p>
<h4 id="9-improper-assets-management">#9 Improper Assets Management</h4>
<p>This is another brilliant catch-all issue, covering a multitude of API security concerns from incomplete separation of environments through to not properly maintaining legacy endpoints.</p>
<p>This exercise starts us off with a V2 API, so it&rsquo;s fairly clear what we&rsquo;re aiming for.</p>
<ul>
<li>
<p>Use the <code>POST</code> request to attempt a login.
<img src="api-60.png" alt="Postman - API9 - Login"></p>
</li>
<li>
<p>Hrmmm 200 OK? but I&rsquo;ll bet that <code>****</code> is not actually the PIN.</p>
</li>
<li>
<p>In ZAP let&rsquo;s break out our <strong>Numberz</strong> fuzzer again. Select the PIN POST request, high-light the PIN, right-click and select <strong>Fuzz</strong>.
<img src="api-61.png" alt="ZAP - API9 - Fuzzing 1"></p>
</li>
<li>
<p>Click on <strong>Payloads</strong>, then <strong>Add</strong> and change the dropdown to <strong>Numberz</strong>. Set the starting number to <strong><em>1000</em></strong> and the ending one to <strong><em>9999</em></strong>.
<img src="api-62.png" alt="ZAP - API9 - Fuzzing 2"></p>
</li>
<li>
<p>Hit <strong>Add</strong> again then <strong>OK</strong> and finally <strong>Start Fuzzer</strong>. The Fuzzer will run for six attempts and then the API will start returning 500 errors.
<img src="api-63.png" alt="ZAP - API9 - Fuzzing 3"></p>
</li>
<li>
<p>Damn, that means rate limiting is in place! So how do we get around that? Let&rsquo;s start by seeing if there is still a V1 API endpoint around.
<img src="api-64.png" alt="ZAP - API9 - Fuzzing 4"></p>
</li>
<li>
<p>Aha! Now let&rsquo;s try that fuzzer again on the newly uncovered endpoint.
<img src="api-65.png" alt="ZAP - API9 - Fuzzing 5"></p>
</li>
<li>
<p>Nothing but 200 OK! Excellent no rate-limiting in sight. Finding the correct PIN is a little more tricky however as they are all 200 OK now&hellip; if you sort by the <strong>Size Resp. Body</strong> column you&rsquo;ll see one actually returns more than just a <code>1</code>.
<img src="api-66.png" alt="ZAP - API9 - Fuzzing 6"></p>
</li>
<li>
<p>And the response gives you your ninth flag!
<img src="api-67.png" alt="ZAP - API9 - Fuzzing 7"></p>
</li>
</ul>
<h4 id="10-insufficient-logging--monitoring">#10 Insufficient Logging &amp; Monitoring</h4>
<p>Without the right (sufficient and concise enough) logging there is no way to monitor, so these two are one issue. There is actually an OWASP project dedicated to benchmarking log files (<a href="https://owasp.org/www-project-secure-logging-benchmark/">OWASP Secure Logging Benchmark</a>) because of how important this is, especially for APIs.</p>
<p>The exercise is a very simple one as there simply are no useful logs being kept:</p>
<ul>
<li>In Postman simply <code>GET</code> the flag. It&rsquo;s been a lot of work to get here, this last one is free!
<img src="api-68.png" alt="Postman - API10 - Get flag"></li>
</ul>
<h3 id="wrapping-it-up">Wrapping it up</h3>
<p>If you enjoyed this walk-through and would like to know more about how we use tools like this CTF to teach development teams how to properly secure and automatically test their APIs please do reach out to us.</p>

				</div>
		</div>

      </div>

	  
    </div>

    

	
</div>
		

<div id="contact-us" class="relative isolate bg-white">
	<div class="mx-auto grid max-w-7xl grid-cols-1 lg:grid-cols-2">
		<div class="relative px-6 pb-20 pt-24 sm:pt-32 lg:static lg:px-8 lg:py-48">
			<div class="mx-auto max-w-xl lg:mx-0 lg:max-w-lg">
				<div class="absolute inset-y-0 left-0 -z-10 w-full overflow-hidden bg-gray-100 ring-1 ring-gray-900/10 lg:w-1/2">
				<svg class="absolute inset-0 h-full w-full stroke-gray-200 [mask-image:radial-gradient(100%_100%_at_top_right,white,transparent)]" aria-hidden="true">
					<defs>
					<pattern id="83fd4e5a-9d52-42fc-97b6-718e5d7ee527" width="200" height="200" x="100%" y="-1" patternUnits="userSpaceOnUse">
						<path d="M130 200V.5M.5 .5H200" fill="none" />
					</pattern>
					</defs>
					<rect width="100%" height="100%" stroke-width="0" fill="white" />
					<svg x="100%" y="-1" class="overflow-visible fill-gray-50">
					<path d="M-470.5 0h201v201h-201Z" stroke-width="0" />
					</svg>
					<rect width="100%" height="100%" stroke-width="0" fill="url(#83fd4e5a-9d52-42fc-97b6-718e5d7ee527)" />
				</svg>
				</div>
				<h2 class="text-3xl font-bold tracking-tight text-gray-900">Get in touch</h2>
				<p class="mt-6 text-lg leading-8 text-gray-600">
				We'd love to hear from you. Let's start your journey to world-class secure software product delivery today!
				</p>
				<dl class="mt-10 space-y-4 text-base leading-7 text-gray-600">
				<div class="flex gap-x-4">
					<dt class="flex-none">
					<span class="sr-only">Address</span>
					<svg class="h-7 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
						<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" />
					</svg>
					</dt>
					<dd>Secure Delivery<br>
					Office 7, 35/37 Ludgate Hill<br>
					London<br>
					EC4M 7JN
					</dd>
				</div>
				<div class="flex gap-x-4">
					<dt class="flex-none">
					<span class="sr-only">Telephone</span>
					<svg class="h-7 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
						<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 002.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 01-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 00-1.091-.852H4.5A2.25 2.25 0 002.25 4.5v2.25z" />
					</svg>
					</dt>
					<dd><a class="hover:text-gray-900" href="tel:+1 (555) 234-5678">+44 (0) 207 459 443
					</a></dd>
				</div>
				<div class="flex gap-x-4">
					<dt class="flex-none">
					<span class="sr-only">Email</span>
					<svg class="h-7 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
						<path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
					</svg>
					</dt>
					<dd><a class="hover:text-gray-900" href="mailto:hello@example.com">enquiries@securedelivery.io</a></dd>
				</div>
				</dl>
			</div>
		</div>
		<div class="px-6 pb-24 pt-20 sm:pb-32 lg:px-8 lg:py-48">
			<div class="pipedriveWebForms" data-pd-webforms="https://webforms.pipedrive.com/f/1sUKi1bzhH8kmFCMnZFoWAcftAMp9HYHqLdbLAaHwW9OIbqumrZEkLCJJ2pamBW9B"><script src="https://webforms.pipedrive.com/f/loader"></script></div>
		</div>
	</div>
</div>
<footer class="bg-gray-900" aria-labelledby="footer-heading">
    <h2 id="footer-heading" class="sr-only">Footer</h2>
    <div class="mx-auto max-w-7xl px-6 pb-8 pt-16 sm:pt-24 lg:px-8 lg:pt-32">
      <div class="xl:grid xl:grid-cols-3 xl:gap-8">
        <div class="space-y-8">
          <img class="h-7" src="/images/logo-coral-white.png" alt="Secure Delivery Logo">
          <p class="text-sm leading-6 text-gray-300">Hey, you made it to the footer! You are determined and see things through. If you see us at an event, tell us "I made it!" and we'll give you some swag.</p>
          <div class="flex space-x-6">
            <a href="https://linkedin.com/company/securedelivery" class="text-gray-500 hover:text-gray-400">
              <span class="sr-only">LinkedIn</span>
              <svg fill="currentColor" xmlns="http://www.w3.org/2000/svg"  viewBox="0 0 50 50" class="w-6 h-6">    <path d="M41,4H9C6.24,4,4,6.24,4,9v32c0,2.76,2.24,5,5,5h32c2.76,0,5-2.24,5-5V9C46,6.24,43.76,4,41,4z M17,20v19h-6V20H17z M11,14.47c0-1.4,1.2-2.47,3-2.47s2.93,1.07,3,2.47c0,1.4-1.12,2.53-3,2.53C12.2,17,11,15.87,11,14.47z M39,39h-6c0,0,0-9.26,0-10 c0-2-1-4-3.5-4.04h-0.08C27,24.96,26,27.02,26,29c0,0.91,0,10,0,10h-6V20h6v2.56c0,0,1.93-2.56,5.81-2.56 c3.97,0,7.19,2.73,7.19,8.26V39z"/></svg>
            </a>
            <a href="https://twitter.com/securedelivery" class="text-gray-500 hover:text-gray-400">
              <span class="sr-only">Twitter</span>
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" />
              </svg>
            </a>
            <a href="https://github.com/secure-delivery" class="text-gray-500 hover:text-gray-400">
              <span class="sr-only">GitHub</span>
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd" />
              </svg>
            </a>
            <a href="https://www.youtube.com/channel/UCLp7d3xPdMtGNafaStWeOpg" class="text-gray-500 hover:text-gray-400">
              <span class="sr-only">YouTube</span>
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path fill-rule="evenodd" d="M19.812 5.418c.861.23 1.538.907 1.768 1.768C21.998 8.746 22 12 22 12s0 3.255-.418 4.814a2.504 2.504 0 0 1-1.768 1.768c-1.56.419-7.814.419-7.814.419s-6.255 0-7.814-.419a2.505 2.505 0 0 1-1.768-1.768C2 15.255 2 12 2 12s0-3.255.417-4.814a2.507 2.507 0 0 1 1.768-1.768C5.744 5 11.998 5 11.998 5s6.255 0 7.814.418ZM15.194 12 10 15V9l5.194 3Z" clip-rule="evenodd" />
              </svg>
            </a>
            <a href="https://instagram.com/securedelivery.io" class="text-gray-500 hover:text-gray-400">
              <span class="sr-only">Instagram</span>
              <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                <path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.067.06 1.407.06 4.123v.08c0 2.643-.012 2.987-.06 4.043-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.067.048-1.407.06-4.123.06h-.08c-2.643 0-2.987-.012-4.043-.06-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.047-1.024-.06-1.379-.06-3.808v-.63c0-2.43.013-2.784.06-3.808.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 015.45 2.525c.636-.247 1.363-.416 2.427-.465C8.901 2.013 9.256 2 11.685 2h.63zm-.081 1.802h-.468c-2.456 0-2.784.011-3.807.058-.975.045-1.504.207-1.857.344-.467.182-.8.398-1.15.748-.35.35-.566.683-.748 1.15-.137.353-.3.882-.344 1.857-.047 1.023-.058 1.351-.058 3.807v.468c0 2.456.011 2.784.058 3.807.045.975.207 1.504.344 1.857.182.466.399.8.748 1.15.35.35.683.566 1.15.748.353.137.882.3 1.857.344 1.054.048 1.37.058 4.041.058h.08c2.597 0 2.917-.01 3.96-.058.976-.045 1.505-.207 1.858-.344.466-.182.8-.398 1.15-.748.35-.35.566-.683.748-1.15.137-.353.3-.882.344-1.857.048-1.055.058-1.37.058-4.041v-.08c0-2.597-.01-2.917-.058-3.96-.045-.976-.207-1.505-.344-1.858a3.097 3.097 0 00-.748-1.15 3.098 3.098 0 00-1.15-.748c-.353-.137-.882-.3-1.857-.344-1.023-.047-1.351-.058-3.807-.058zM12 6.865a5.135 5.135 0 110 10.27 5.135 5.135 0 010-10.27zm0 1.802a3.333 3.333 0 100 6.666 3.333 3.333 0 000-6.666zm5.338-3.205a1.2 1.2 0 110 2.4 1.2 1.2 0 010-2.4z" clip-rule="evenodd" />
              </svg>
            </a>
          </div>
        </div>
        <div class="mt-16 grid grid-cols-2 gap-8 xl:col-span-2 xl:mt-0">
          <div class="md:grid md:grid-cols-2 md:gap-8">
            <div>
              <h3 class="text-sm font-semibold leading-6 text-white">Solutions</h3>
              <ul role="list" class="mt-6 space-y-4">
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Marketing</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Analytics</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Commerce</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Insights</a>
                </li>
              </ul>
            </div>
            <div class="mt-10 md:mt-0">
              <h3 class="text-sm font-semibold leading-6 text-white">Support</h3>
              <ul role="list" class="mt-6 space-y-4">
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Pricing</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Documentation</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Guides</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">API Status</a>
                </li>
              </ul>
            </div>
          </div>
          <div class="md:grid md:grid-cols-2 md:gap-8">
            <div>
              <h3 class="text-sm font-semibold leading-6 text-white">Company</h3>
              <ul role="list" class="mt-6 space-y-4">
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">About</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Blog</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Jobs</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Press</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Partners</a>
                </li>
              </ul>
            </div>
            <div class="mt-10 md:mt-0">
              <h3 class="text-sm font-semibold leading-6 text-white">Legal</h3>
              <ul role="list" class="mt-6 space-y-4">
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Claim</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Privacy</a>
                </li>
                <li>
                  <a href="#" class="text-sm leading-6 text-gray-300 hover:text-white">Terms</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
      <div class="mt-16 border-t border-white/10 pt-8 sm:mt-20 lg:mt-24">
        <p class="text-xs leading-5 text-gray-400">Secure Delivery is a limited company registered in England and Wales. Registered number: 12465389. Registered office: Office 7, 35/37 Ludgate Hill, London, EC4M 7JN.</p>
        <p class="mt-4 text-xs leading-5 text-gray-400">Copyrights &copy; 2020-2023 Secure Delivery Ltd. All rights reserved.</p>
      </div>
    </div>
  </footer>
</div>
</body>
</html>
